## the idea: shift register

@0
COM:JRO ANY
R:MOV 1 DOWN#R
  MOV ACC DOWN
  MOV DOWN NIL
  MOV LEFT ACC
  JMP COM
X:MOV -4 RIGHT
  JMP COM
F:MOV 7 DOWN
  MOV ACC DOWN
  MOV 10 DOWN
  JMP COM

@1
READ:MOV UP, ACC
JEZ SF
MOV 1 LEFT #PASS
MOV ACC LEFT
JRO LEFT #XOK
SF:MOV 8 LEFT

@2
START:MOV 0, RIGHT
READ: MOV UP, ACC
JEZ FLUSH
MOV ACC RIGHT
JMP READ
FLUSH:
MOV RIGHT ACC
JEZ ENDFLUSH
MOV ACC DOWN
JMP FLUSH
ENDFLUSH:
MOV 0 DOWN

@3
COM:JRO ANY
R:MOV 1 RIGHT
  MOV ACC RIGHT
  MOV UP ACC
  JMP COM
X:MOV 6 UP
  JMP COM
P:MOV 7 RIGHT#SP
  MOV UP RIGHT
  JMP COM
F:JEZ COM
  MOV 7 RIGHT
  MOV ACC RIGHT
  JMP COM

@4
COM:JRO ANY
R:MOV 1 RIGHT
  MOV ACC RIGHT
  MOV LEFT ACC
  JMP COM
X:MOV 5 LEFT
  JMP COM
P:MOV 7 RIGHT#SP
  MOV LEFT RIGHT
  JMP COM
F:JEZ COM
  MOV 7 RIGHT
  MOV ACC RIGHT
  JMP COM

@5
COM:JRO ANY
R:MOV 1 RIGHT
  MOV ACC RIGHT
  MOV LEFT ACC
  JMP COM
X:MOV 5 LEFT
  JMP COM
P:MOV 7 RIGHT#SP
  MOV LEFT RIGHT
  JMP COM
F:JEZ COM
  MOV 7 RIGHT
  MOV ACC RIGHT
  JMP COM

@6
COM:JRO ANY
R:MOV 1 DOWN
  MOV ACC DOWN
  MOV LEFT ACC
  JMP COM
X:MOV 5 LEFT
  JMP COM
P:MOV 7 DOWN#SP
  MOV LEFT DOWN
  JMP COM
F:JEZ COM
  MOV 7 DOWN
  MOV ACC DOWN
  JMP COM

@7
COM:JRO ANY
R:MOV 5 RIGHT#X
  JMP COM
P:MOV RIGHT DOWN
  JMP COM

@8
COM:JRO ANY
R:MOV 1 LEFT
  #MOV ACC LEFT
  MOV UP ACC
  JMP COM
X:MOV 5 UP
  JMP COM
P:MOV 3 LEFT#SP
  MOV UP LEFT
  JMP COM
F:JEZ COM
  MOV 3 LEFT#SP
  MOV ACC LEFT
  JMP COM
